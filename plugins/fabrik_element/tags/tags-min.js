/*! Fabrik */
var FbTags=new Class({options:{rowid:"",id:0,listid:""},Extends:FbElement,initialize:function(e,t){this.parent(e,t),this.options.editable&&this.setUp()},setUp:function(){jQuery("#"+this.options.element).chosen({disable_search_threshold:10,allow_single_deselect:!0}),this.sel=jQuery("#"+this.options.element).ajaxChosen({type:"GET",url:Fabrik.liveSite+"index.php?option=com_fabrik&view=list&listid="+this.options.listid+"&format=tags&elID="+this.options.id,dataType:"json",jsonTermKey:"like",afterTypeDelay:"500",minTermLength:"3"},function(e){var t=[];return jQuery.each(e,function(e,i){t.push({value:i.value,text:i.text})}),t});var e=this.sel;this.sel.on("change",function(t){var i=jQuery(e).find("option");jQuery(e.data().chosen.results_data).each(function(){jQuery(i[this.options_index]).attr("selected",this.selected)})}),this.watchNew()},watchNew:function(){var e,t="#fabrik#",i=jQuery(this.getContainer()),n=this.options.element,s=i.find(".search-field input");s.keydown(function(s){if(this.value.length>=3&&(13===s.which||188===s.which)){var a=i.find("li.active-result.highlighted").first();if(13===s.which&&""!==a.text()){var r=t+a.text();i.find("option").filter(function(){return jQuery(this).val()===r}).remove(),e=i.find("option").filter(function(){return jQuery(this).html()===a.text()}),e.attr("selected","selected")}else{var l=this.value;if(e=i.find("option").filter(function(){return jQuery(this).html()===l}),""!==e.text())e.attr("selected","selected");else{var o=jQuery("<option>");o.text(this.value).val(t+this.value),o.attr("selected","selected"),i.find("select").append(o)}}this.value="",jQuery("#"+n).trigger("liszt:updated"),s.preventDefault()}})},cloned:function(e){Fabrik.fireEvent("fabrik.tags.update",this),this.parent(e),this.setUp()}});