/*! Fabrik */
define(["jquery","fab/element"],function(a,b){return window.FbTags=new Class({options:{rowid:"",id:0,listid:""},Extends:b,initialize:function(a,b){this.parent(a,b),this.options.editable&&this.setUp()},setUp:function(){a("#"+this.options.element).chosen({disable_search_threshold:10,allow_single_deselect:!0}),this.sel=a("#"+this.options.element).ajaxChosen({type:"GET",url:Fabrik.liveSite+"index.php?option=com_fabrik&view=list&listid="+this.options.listid+"&format=tags&elID="+this.options.id,dataType:"json",jsonTermKey:"like",afterTypeDelay:"500",minTermLength:"3"},function(b){var c=[];return a.each(b,function(a,b){c.push({value:b.value,text:b.text})}),c});var b=this.sel;this.sel.on("change",function(){var c=a(b).find("option");a(b.data().chosen.results_data).each(function(){a(c[this.options_index]).attr("selected",this.selected)})}),this.watchNew()},watchNew:function(){var b,c="#fabrik#",d=a(this.getContainer()),e=this.options.element,f=d.find(".search-field input");f.keydown(function(f){if(this.value.length>=3&&(13===f.which||188===f.which)){var g=d.find("li.active-result.highlighted").first();if(13===f.which&&""!==g.text()){var h=c+g.text();d.find("option").filter(function(){return a(this).val()===h}).remove(),b=d.find("option").filter(function(){return a(this).html()===g.text()}),b.attr("selected","selected")}else{var i=this.value;if(b=d.find("option").filter(function(){return a(this).html()===i}),""!==b.text())b.attr("selected","selected");else{var j=a("<option>");j.text(this.value).val(c+this.value),j.attr("selected","selected"),d.find("select").append(j)}}this.value="",a("#"+e).trigger("liszt:updated"),f.preventDefault()}})},cloned:function(a){Fabrik.fireEvent("fabrik.tags.update",this),this.parent(a),this.setUp()}}),window.FbTags});